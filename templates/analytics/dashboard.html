{% extends 'base.html' %}
{% block title %}Аналитика — FlowerDelivery Master{% endblock %}
{% block content %}
<h1 class="mb-4">Аналитика и отчёты</h1>
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h6>Заказов сегодня</h6>
                <h3>{{ orders_today }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h6>Всего заказов</h6>
                <h3>{{ total_orders }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h6>Выручка (всего)</h6>
                <h3>{{ revenue|floatformat:0 }} ₽</h3>
            </div>
        </div>
    </div>
</div>
<h5>Заказы по статусам</h5>
<table class="table table-sm">
    <thead><tr><th>Статус</th><th>Количество</th></tr></thead>
    <tbody>
    {% for row in orders_by_status %}
    <tr><td>{{ row.status }}</td><td>{{ row.c }}</td></tr>
    {% endfor %}
    </tbody>
</table>
<h5 class="mt-4">Последние заказы</h5>
<table class="table">
    <thead><tr><th>ID</th><th>Клиент</th><th>Дата</th><th>Статус</th></tr></thead>
    <tbody>
    {% for order in recent_orders %}
    <tr>
        <td><a href="{% url 'admin:orders_order_change' order.id %}">{{ order.id }}</a></td>
        <td>{{ order.user.get_full_name|default:order.user.username }}</td>
        <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
        <td>{{ order.get_status_display }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<p><a href="{% url 'analytics:reports' %}" class="btn btn-fd">Отчёты</a></p>
{% endblock %}
