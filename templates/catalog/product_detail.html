{% extends 'base.html' %}
{% block title %}{{ product.name }} — FlowerDelivery Master{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-5">
        {% if product.image %}
            <img src="{{ product.image.url }}" class="img-fluid rounded-3 shadow" alt="{{ product.name }}">
        {% else %}
            <div class="bg-secondary rounded-3 d-flex align-items-center justify-content-center text-white p-5"><i class="bi bi-flower2" style="font-size: 8rem;"></i></div>
        {% endif %}
    </div>
    <div class="col-md-7">
        <h1>{{ product.name }}</h1>
        <p class="lead text-success fw-bold">{{ product.price }} ₽</p>
        <p class="text-muted">{{ product.description|default:"Описание отсутствует." }}</p>
        <form action="{% url 'orders:cart_add' product.id %}" method="get" class="d-flex gap-2 align-items-center">
            <input type="hidden" name="next" value="{{ request.path }}">
            <input type="number" name="quantity" value="1" min="1" class="form-control" style="width: 80px;">
            <button type="submit" class="btn btn-fd">Добавить в корзину</button>
        </form>
        {% if user.is_authenticated %}
            <p class="mt-3"><a href="{% url 'reviews:add_review' product.id %}" class="btn btn-outline-primary btn-sm">Оставить отзыв</a></p>
        {% endif %}
    </div>
</div>
<hr class="my-4">
<h5>Отзывы и рейтинг</h5>
{% for review in reviews %}
<div class="card mb-2">
    <div class="card-body py-2">
        <strong>{{ review.user.get_full_name|default:review.user.username }}</strong>
        <span class="text-warning">{% for i in "12345" %}{% if forloop.counter <= review.rating %}★{% else %}☆{% endif %}{% endfor %}</span>
        <span class="text-muted small">{{ review.created_at|date:"d.m.Y" }}</span>
        <p class="mb-0 mt-1">{{ review.text }}</p>
    </div>
</div>
{% empty %}
<p class="text-muted">Пока нет отзывов.</p>
{% endfor %}
{% endblock %}
